(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))i(t);new MutationObserver(t=>{for(const a of t)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function s(t){const a={};return t.integrity&&(a.integrity=t.integrity),t.referrerPolicy&&(a.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?a.credentials="include":t.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(t){if(t.ep)return;t.ep=!0;const a=s(t);fetch(t.href,a)}})();let currentlyDragged;function makeDraggable(n){n.setAttribute("draggable",!0),n.addEventListener("dragstart",e=>{currentlyDragged=e.target;const s=window.getComputedStyle(e.target,null),i=parseInt(s.getPropertyValue("left"),10)-e.clientX,t=parseInt(s.getPropertyValue("top"),10)-e.clientY,a={posX:i,posY:t};e.dataTransfer.setData("application/json",JSON.stringify(a))})}function makeDropZone(n){n.addEventListener("dragenter",e=>{e.preventDefault()}),n.addEventListener("dragover",e=>{e.preventDefault()}),n.addEventListener("drop",e=>{const s=JSON.parse(e.dataTransfer.getData("application/json")),i=e.clientX,t=e.clientY;currentlyDragged.style.left=i+s.posX+"px",currentlyDragged.style.top=t+s.posY+"px"})}class AppWindow extends HTMLElement{appBox;#t;contextMenu;constructor(){super(),this.#n(),this.#s(),this.appBox.addEventListener("contextmenu",e=>{e.preventDefault(),this.#i(e.pageX,e.clientY)}),document.addEventListener("click",()=>{this.#e()})}#n(){this.appBox=document.createElement("div"),this.appBox.classList.add("app-window"),makeDraggable(this.appBox);const e=document.createElement("div");e.classList.add("window-navbar"),this.appBox.appendChild(e),this.#t=document.createElement("p"),e.appendChild(this.#t);const s=document.createElement("div");s.classList.add("close-button");const i=document.createElement("h1");i.textContent="X",s.appendChild(i),e.appendChild(s),s.addEventListener("click",()=>{this.appBox.remove(),this.remove()}),document.getElementById("desktop").appendChild(this.appBox)}#s(){this.contextMenu=document.createElement("div"),this.contextMenu.classList.add("hidden","app-context-menu");const e=document.createElement("ul");this.contextMenu.appendChild(e),this.appBox.appendChild(this.contextMenu)}setTitle(e){this.#t.textContent=e}#i(e,s){const i=e-this.appBox.getBoundingClientRect().left,t=s-this.appBox.getBoundingClientRect().top;this.contextMenu.style.left=i+"px",this.contextMenu.style.top=t+"px",this.contextMenu.classList.remove("hidden")}#e(){this.contextMenu.classList.add("hidden")}addContextMenuOption(e,s){const i=document.createElement("li"),t=document.createElement("p");i.classList.add(s),t.textContent=e,i.appendChild(t),this.contextMenu.lastChild.appendChild(i)}}class MemoryGame extends AppWindow{#t;gameStarted=!1;#n;#s;#i;#e=4;#a=4;gameboard;selectedTileIndex;selectedTile;#o;connectedCallback(){this.setTitle("Memory game"),this.#r(),this.#p()}disconnectedCallback(){}#r(){const e=document.createElement("div");e.classList.add("memory-game-menu");const s=document.createElement("p");s.textContent=`Press a button to start a new game
or press ENTER`,e.appendChild(s);const i=document.createElement("div");i.classList.add("column","memory-menu-button-box"),e.appendChild(i);const t=document.createElement("input");t.classList.add("memory-menu-button"),t.setAttribute("type","submit");const a=t.cloneNode(!0),o=t.cloneNode(!0);t.setAttribute("value","2x2"),a.setAttribute("value","2x4"),o.setAttribute("value","4x4"),t.addEventListener("click",()=>{this.gameStart(2,2)}),a.addEventListener("click",()=>{this.gameStart(2,4)}),o.addEventListener("click",()=>{this.gameStart(4,4)}),i.appendChild(t),i.appendChild(a),i.appendChild(o),this.appBox.appendChild(e)}gameStart(e,s){this.gameStarted=!0,this.#e=e,this.#a=s,this.#i=Array(e*s),this.appBox.removeChild(this.appBox.lastChild),this.#d()}#d(){this.#o=[];for(let a=0;a<this.#e*this.#a;a++)this.#i[a]=!1;this.#n=document.createElement("div"),this.#n.classList.add("memory-game-window"),this.#l(this.#e*this.#a),this.#h(),this.#n.appendChild(this.gameboard);const e=document.createElement("div");e.classList.add("controls-box");const s=document.createElement("p"),i=`R - new game
↑ - select up
↓ - select down
← - select left
→ - select right
ENTER or SPACE - flip card`;s.textContent=i,e.appendChild(s),this.#n.appendChild(e);const t=document.createElement("input");t.classList.add("memory-game-restart-button"),t.setAttribute("type","submit"),t.setAttribute("value","New Game"),t.addEventListener("click",()=>{this.restartGame()}),this.#n.appendChild(t),this.appBox.appendChild(this.#n),this.#c(0)}#l(e){const s=[];for(let i=0;i<e/2;i++)s[2*i]=i+1,s[2*i+1]=i+1;for(let i=s.length-1;i>0;i--){const t=Math.floor(Math.random()*(i+1)),a=s[i];s[i]=s[t],s[t]=a}this.#t=s}#h(){this.gameboard=document.createElement("div"),this.gameboard.classList.add("gameboard");let e=0;for(let s=0;s<this.#a;s++){const i=document.createElement("div");i.classList.add("memory-row"),this.gameboard.appendChild(i);for(let t=0;t<this.#e;t++){const a=document.createElement("div");a.classList.add("memory-card","memory-card-active"),a.setAttribute("card-index",e),a.setAttribute("image-id",this.#t[e]);const o=document.createElement("img");o.classList.add("memory-card-image","invisible"),o.setAttribute("src","./img/pet-"+this.#t[e]+".png"),o.setAttribute("draggable","false"),a.appendChild(o),a.addEventListener("click",()=>{this.#m(a),console.log(a.element)}),this.#o.push(a),i.appendChild(a),e++}}}#m(e){const s=e.lastChild;if(s.classList.remove("invisible"),s.classList.add("visible"),!this.#s)this.#s=e;else{if(this.#s===e)return;const i=this.#s.getAttribute("image-id"),t=e.getAttribute("image-id");this.gameboard.classList.add("unclickable"),i!==t?setTimeout(()=>{this.#s.lastChild.classList.add("invisible"),s.classList.add("invisible"),this.#s.lastChild.classList.remove("visible"),s.classList.remove("visible"),this.#s=null,this.gameboard.classList.remove("unclickable")},1500):(this.#i[e.getAttribute("card-index")]=!0,this.#i[this.#s.getAttribute("card-index")]=!0,this.#s.classList.remove("memory-card-active"),e.classList.remove("memory-card-active"),this.#s=null,this.gameboard.classList.remove("unclickable"),this.#u()&&this.#g())}}#p(){this.addEventListener("keypress",function(e){this.gameStarted?e.key==="r"||e.key==="R"?(e.preventDefault(),this.restartGame()):(e.key==="Enter"||e.key===" ")&&(this.gameboard.classList.contains("unclickable")||this.selectedTile.click()):(e.key==="Enter"||e.key===" ")&&this.gameStart(4,4)}),this.addEventListener("keydown",function(e){this.gameStarted&&(e.key==="ArrowRight"?this.selectRight():e.key==="ArrowUp"?this.selectUp():e.key==="ArrowLeft"?this.selectLeft():e.key==="ArrowDown"&&this.selectDown())})}restartGame(){this.appBox.removeChild(this.#n),this.#d()}#c(e){this.selectedTile!=null&&this.selectedTile.classList.remove("memory-card-selected"),this.selectedTile=this.#o[e],this.selectedTileIndex=e,console.log(this.selectedTile),this.selectedTile.classList.add("memory-card-selected")}selectDown(){this.selectedTileIndex+this.#e<this.#e*this.#a&&this.#c(this.selectedTileIndex+this.#e)}selectUp(){this.selectedTileIndex-this.#e>=0&&this.#c(this.selectedTileIndex-this.#e)}selectLeft(){this.selectedTileIndex>~~(this.selectedTileIndex/this.#e)*this.#e&&this.#c(this.selectedTileIndex-1)}selectRight(){this.selectedTileIndex+1<(~~(this.selectedTileIndex/this.#e)+1)*this.#e&&this.#c(this.selectedTileIndex+1)}#u(){for(let e=0;e<this.#e*this.#a;e++)if(!this.#i[e])return!1;return!0}#g(){const e=document.createElement("h1");e.textContent="Victory",e.classList.add("memory-game-victory-message"),this.gameboard.appendChild(e)}}function getTime(){const n=new Date,e=(n.getMinutes()<10?"0":"")+n.getMinutes();return n.getHours()+":"+e}class Chat extends AppWindow{#url="wss://courselab.lnu.se/message-app/socket";#username;#channel;#websocket;chatBox;connectedCallback(){this.#retrieveUsername(),this.#retrieveChannel(),this.#username?(this.#openSocket(),this.#buildChat()):this.#buildMenu(),this.setTitle("Chat")}disconnectedCallback(){this.#websocket&&this.#closeSocket()}#buildMenu(){const n=document.createElement("div");n.classList.add("column","chat-menu");const e=document.createElement("input");e.setAttribute("placeholder","username"),e.classList.add("chat-menu-input"),e.addEventListener("keypress",t=>{t.key==="Enter"&&i.click()}),n.appendChild(e);const s=document.createElement("input");s.setAttribute("placeholder","channel id"),s.classList.add("chat-menu-input"),s.addEventListener("keypress",t=>{t.key==="Enter"&&i.click()}),n.appendChild(s);const i=document.createElement("input");i.classList.add("chat-menu-button"),i.setAttribute("type","submit"),i.setAttribute("value","Enter chat"),i.addEventListener("click",()=>{if(e.value!=="")this.#newUsername(e.value),this.#newChannel(s.value),n.remove(),this.#openSocket(),this.#buildChat();else if(document.getElementsByName("p").length===0){const t=document.createElement("p");t.textContent="Enter username!",n.appendChild(t)}}),n.appendChild(i),this.appBox.appendChild(n)}#buildChat(){const n=document.createElement("div");n.classList.add("column","chat-container");const e=document.createElement("div");this.chatBox=e,e.classList.add("chat-box"),n.appendChild(e);const s=document.createElement("div");s.classList.add("row","chat-send-box"),n.appendChild(s);const i=document.createElement("textarea");i.classList.add("chat-send-textbox"),s.appendChild(i),i.addEventListener("keypress",a=>{a.key==="Enter"&&(a.preventDefault(),t.click())});const t=document.createElement("input");t.classList.add("chat-send-button"),t.setAttribute("type","submit"),t.setAttribute("value","Send"),t.addEventListener("click",()=>{i.value!==""&&(this.#sendMessage(i.value),i.value="")}),s.appendChild(t),this.appBox.appendChild(n),this.#createContextMenu(),i.focus()}#handleNewMessage(n){const e=this.chatBox.scrollHeight===this.chatBox.scrollTop+this.chatBox.offsetHeight,s=document.createElement("div");s.classList.add("chat-row"),this.chatBox.appendChild(s);const i=getTime();n.type==="message"?n.channel===this.#channel||this.#channel===""||!this.#channel?this.#userMessage(s,n.username,n.data,i):s.remove():n.type==="notification"&&this.#chatLog(s,n.data),e&&(this.chatBox.scrollTop=this.chatBox.scrollHeight-this.chatBox.offsetHeight)}#userMessage(n,e,s,i){n.classList.add("chat-message-row");const t=document.createElement("div");t.classList.add("chat-message-top-row"),n.appendChild(t);const a=document.createElement("p");a.classList.add("chat-message-username"),a.textContent=e,t.appendChild(a);const o=document.createElement("p");o.classList.add("chat-message-time"),o.textContent=i,t.appendChild(o);const d=document.createElement("p");d.classList.add("chat-message-text"),d.textContent=s,n.appendChild(d)}#chatLog(n,e){const s=document.createElement("p");s.classList.add("chat-log-text"),s.textContent=e,n.appendChild(s)}#openSocket(){this.#websocket=new WebSocket(this.#url),this.#websocket.onmessage=n=>{const e=JSON.parse(n.data);e.type!=="heartbeat"&&this.#handleNewMessage(e)}}#closeSocket(){this.#websocket.send("Client closing connection by intention."),this.#websocket.close()}#sendMessage(n){const e={type:"message",data:n,username:this.#username,channel:this.#channel,key:"eDBE76deU7L0H9mEBgxUKVR0VCnq0XBd"},s=JSON.stringify(e);this.#websocket&&this.#websocket.readyState===1&&this.#websocket.send(s)}#retrieveUsername(){const n=window.localStorage;this.#username=n.getItem("chat-username")||null}#newUsername(n){window.localStorage.setItem("chat-username",n),this.#username=n}#retrieveChannel(){const n=window.localStorage;this.#channel=n.getItem("chat-channel")||null}#newChannel(n){window.localStorage.setItem("chat-channel",n),this.#channel=n}changePrompt(c){if(c===0||c===1){let changed="";if(c===0?changed="username":changed="channel",this.appBox.getElementsByClassName("grayed-out").length===0){const cover=document.createElement("div");cover.classList.add("column","grayed-out");const popup=document.createElement("div");popup.classList.add("column","chat-popup"),cover.appendChild(popup);const input=document.createElement("input");input.classList.add("chat-popup-input"),input.setAttribute("placeholder","new "+changed),popup.appendChild(input);const submit=document.createElement("input");submit.setAttribute("type","submit"),submit.classList.add("chat-popup-button"),submit.setAttribute("value","Change "+changed),submit.addEventListener("click",()=>{changed=changed.charAt(0).toUpperCase()+changed.slice(1),eval("this.#new"+changed+"('"+input.value+"')"),this.appBox.getElementsByClassName("grayed-out")[0].remove()}),popup.appendChild(submit),input.addEventListener("keypress",n=>{n.key==="Enter"&&submit.click()});const cancelButton=document.createElement("input");cancelButton.setAttribute("type","submit"),cancelButton.classList.add("chat-popup-button"),cancelButton.setAttribute("value","Go back"),cancelButton.addEventListener("click",()=>{this.appBox.getElementsByClassName("grayed-out")[0].remove()}),popup.appendChild(cancelButton),this.appBox.lastChild.appendChild(cover)}}}#createContextMenu(){this.addContextMenuOption("Change username","chat-username-change-button"),this.appBox.getElementsByClassName("chat-username-change-button")[0].addEventListener("click",()=>{this.changePrompt(0)}),this.addContextMenuOption("Change channel","chat-channel-change-button"),this.appBox.getElementsByClassName("chat-channel-change-button")[0].addEventListener("click",()=>{this.changePrompt(1)})}}class SnakeGame extends AppWindow{Directions={Up:0,Right:1,Down:2,Left:3};snakeGame;width=20;height=20;snakeLength;currentDirection;gameboard;foodPos;interval;connectedCallback(){this.setTitle("Snake"),this.#t(),this.buildApp(),this.playGame()}disconnectedCallback(){this.interval&&clearInterval(this.interval)}buildApp(){this.snakeGame=document.createElement("div"),this.snakeGame.classList.add("column","snake-game"),this.appBox.appendChild(this.snakeGame)}buildGameUI(){const e=document.createElement("div");e.classList.add("controls-box");const s=document.createElement("p"),i=`R - new game
W - up
S - down
A - left
D - right`;s.textContent=i,e.appendChild(s),this.snakeGame.appendChild(e);const t=document.createElement("input");t.classList.add("memory-game-restart-button"),t.setAttribute("type","submit"),t.setAttribute("value","New Game"),t.addEventListener("click",()=>{this.restartGame()}),this.snakeGame.appendChild(t)}playGame(){this.snakeLength=2,this.currentDirection=this.Directions.Right,this.gameState=[],this.gameState.push({x:this.width/2,y:this.height/2}),this.createBoard(),this.spawnFood(),this.buildGameUI(),this.interval=setInterval(()=>this.updateGame(),350)}updateGame(){const e=this.gameState[this.gameState.length-1],s=e.x,i=e.y;if(this.hasLost()){this.showGameoverMessage(),clearInterval(this.interval);return}this.foodPos.x===e.x&&this.foodPos.y===e.y&&(this.snakeLength++,this.spawnFood()),this.updateBoard(),this.currentDirection===this.Directions.Up?this.gameState.push({x:s,y:i-1}):this.currentDirection===this.Directions.Right?this.gameState.push({x:s+1,y:i}):this.currentDirection===this.Directions.Down?this.gameState.push({x:s,y:i+1}):this.currentDirection===this.Directions.Left&&this.gameState.push({x:s-1,y:i});for(let t=0;t<this.gameState.length-this.snakeLength;t++)this.gameState.shift()}createBoard(){this.gameboard=document.createElement("table"),this.gameboard.classList.add("snake-board-table");for(let e=0;e<this.height;e++){const s=document.createElement("tr");for(let i=0;i<this.height;i++){const t=document.createElement("td");t.classList.add("snake-board-td"),s.appendChild(t)}this.gameboard.appendChild(s)}this.snakeGame.appendChild(this.gameboard)}updateBoard(){for(let i=0;i<this.height;i++)for(let t=0;t<this.width;t++){const a=this.gameboard.rows[i].cells[t];a.classList.remove("snake-board-snake-cell"),a.classList.remove("snake-board-food-cell")}for(let i=0;i<this.gameState.length;i++){const t=this.gameState[i].x,a=this.gameState[i].y;this.gameboard.rows[a].cells[t].classList.add("snake-board-snake-cell")}const e=this.foodPos.x,s=this.foodPos.y;this.gameboard.rows[s].cells[e].classList.add("snake-board-food-cell")}#t(){this.addEventListener("keypress",function(e){e.key==="r"||e.key==="R"?(e.preventDefault(),this.restartGame()):e.key==="ArrowRight"||e.key==="d"||e.key==="D"?this.goRight():e.key==="ArrowUp"||e.key==="w"||e.key==="W"?this.goUp():e.key==="ArrowLeft"||e.key==="a"||e.key==="A"?this.goLeft():(e.key==="ArrowDown"||e.key==="s"||e.key==="S")&&this.goDown()}),this.addEventListener("keydown",function(e){this.gameStarted&&(e.key==="ArrowRight"||e.key==="d"||e.key==="D"?this.goRight():e.key==="ArrowUp"||e.key==="w"||e.key==="W"?this.goUp():e.key==="ArrowLeft"||e.key==="a"||e.key==="A"?this.goLeft():(e.key==="ArrowDown"||e.key==="s"||e.key==="S")&&this.goDown())})}spawnFood(){let e=!0,s=0,i=0;for(;e;){e=!1,s=Math.floor(Math.random()*this.width),i=Math.floor(Math.random()*this.height);for(let t=0;t<this.gameState.length;t++){const a=this.gameState[t].x,o=this.gameState[t].y;if(a===s&&o===i){e=!0;break}}}this.foodPos={x:s,y:i}}dynamicallyUpdate(){this.updateGame(),clearInterval(this.interval),this.interval=setInterval(()=>this.updateGame(),350)}goUp(){this.currentDirection!==this.Directions.Down&&this.currentDirection!==this.Directions.Up&&(this.currentDirection=this.Directions.Up,this.dynamicallyUpdate())}goRight(){this.currentDirection!==this.Directions.Left&&this.currentDirection!==this.Directions.Right&&(this.currentDirection=this.Directions.Right,this.dynamicallyUpdate())}goDown(){this.currentDirection!==this.Directions.Up&&this.currentDirection!==this.Directions.Down&&(this.currentDirection=this.Directions.Down,this.dynamicallyUpdate())}goLeft(){this.currentDirection!==this.Directions.Right&&this.currentDirection!==this.Directions.Left&&(this.currentDirection=this.Directions.Left,this.dynamicallyUpdate())}hasLost(){const e=this.gameState[this.gameState.length-1].x,s=this.gameState[this.gameState.length-1].y;if(e>=this.width||e<0||s>=this.height||s<0)return!0;for(let i=0;i<this.gameState.length-1;i++){const t=this.gameState[i].x,a=this.gameState[i].y;if(t===e&&a===s)return!0}return!1}showGameoverMessage(){const e=document.createElement("h1");e.textContent="Gameover",e.classList.add("snake-gameover-message"),this.gameboard.appendChild(e)}restartGame(){this.snakeGame.remove(),clearInterval(this.interval),this.buildApp(),this.playGame()}}class Desktop extends HTMLElement{#t;#n=90;#s=5;#i;connectedCallback(){this.#e(),makeDropZone(this.#t),document.addEventListener("keypress",e=>{this.#i&&this.#i.dispatchEvent(new KeyboardEvent("keypress",{key:e.key}))}),document.addEventListener("keydown",e=>{this.#i&&this.#i.dispatchEvent(new KeyboardEvent("keydown",{key:e.key}))})}#e(){const e=document.createElement("div");e.classList.add("taskbar"),document.getElementById("pwd-desktop").appendChild(e),this.#t=document.createElement("div"),this.#t.setAttribute("id","desktop"),this.#t.classList.add("desktop"),document.getElementById("pwd-desktop").appendChild(this.#t);const s=document.createElement("p");s.classList.add("desktop-time");const i=getTime();s.textContent=i,setInterval(()=>{const a=getTime();s.textContent=a},6e4),this.#t.appendChild(s);let t=this.#a("/img/icon-memory.png");t.addEventListener("click",a=>{this.#o("memory-game")}),e.appendChild(t),t=this.#a("/img/icon-chat.png"),t.addEventListener("click",a=>{this.#o("chat-app")}),e.appendChild(t),t=this.#a("/img/icon-snake.png"),t.addEventListener("click",a=>{this.#o("snake-game")}),e.appendChild(t)}#a(e){const s=document.createElement("a"),i=document.createElement("div");i.classList.add("button"),s.appendChild(i);const t=document.createElement("img");return t.setAttribute("src",e),i.appendChild(t),s}#o(e){const s=document.createElement(e);this.addApp(s)}addApp(e){e.appBox.style.left=this.#n+"px",e.appBox.style.top=this.#n+"px",this.#n+=10,e.appBox.style.zIndex=++this.#s,this.#i=e,e.appBox.addEventListener("click",s=>{e.appBox.style.zIndex=++this.#s,this.#i=e}),e.appBox.addEventListener("drag",s=>{e.appBox.style.zIndex=++this.#s,this.#i=e}),this.#t.appendChild(e)}}window.customElements.define("memory-game",MemoryGame);window.customElements.define("chat-app",Chat);window.customElements.define("snake-game",SnakeGame);window.customElements.define("pwd-desktop",Desktop);const desktopEl=document.createElement("pwd-desktop");desktopEl.setAttribute("id","pwd-desktop");document.getElementById("body").appendChild(desktopEl);
